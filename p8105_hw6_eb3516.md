p8105_hw6_eb3516
================
Liz Bekerman
2023-12-02

``` r
options(
  ggplot2.continuous.colour="viridis",
  ggplot2.continuous.fill="viridis")

scale_colour_discrete=scale_colour_viridis_d
scale_fill_discrete=scale_fill_viridis_d
```

## Problem 2

First, we import the weather data.

``` r
weather_df=
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var=c("PRCP", "TMIN", "TMAX"),
    date_min="2022-01-01",
    date_max="2022-12-31") |>
  mutate(
    name=recode(id, USW00094728="CentralPark_NY"),
    tmin=tmin/10,
    tmax=tmax/10) |>
  select(name, id, everything())
```

    ## using cached file: /Users/lizbekerman/Library/Caches/org.R-project.R/R/rnoaa/noaa_ghcnd/USW00094728.dly

    ## date created (size, mb): 2023-12-02 11:00:44.015667 (8.544)

    ## file min/max dates: 1869-01-01 / 2023-11-30

The linear model predicts `tmax` using `tmin` and `prcp`.

Next, we will run 5000 bootstraps to estimate R-squared and log(B1\*B2).

``` r
weather_bootstrap = weather_df |>
  bootstrap(n=5000) |>
  mutate(
    models=map(strap, \(weather_df) lm(tmax~tmin+prcp, weather_df)),
    results=map(models, broom::tidy),
    rsq=map(models, broom::glance)
  ) |>
  select(-strap, -models) |>
  unnest(results) |>
  filter(term %in% c("tmin", "prcp")) |>
  group_by(.id) |>
  mutate(B1x2=sum(estimate)) |>
  select(B1x2, rsq) |>
  unnest(rsq) |>
  janitor::clean_names() |>
  select(id, b1x2, r_squared) |> unique()
```

    ## Adding missing grouping variables: `.id`

Next, we’ll calculate the confidence intervals.

``` r
weather_bootstrap |>
  summarize(
    rsq_lower_ci=quantile(r_squared, 0.025),
    rsq_upper_ci=quantile(r_squared, 0.975)
  )
```

    ## # A tibble: 5,000 × 3
    ##    id    rsq_lower_ci rsq_upper_ci
    ##    <chr>        <dbl>        <dbl>
    ##  1 0001         0.907        0.907
    ##  2 0002         0.913        0.913
    ##  3 0003         0.912        0.912
    ##  4 0004         0.907        0.907
    ##  5 0005         0.912        0.912
    ##  6 0006         0.927        0.927
    ##  7 0007         0.929        0.929
    ##  8 0008         0.936        0.936
    ##  9 0009         0.918        0.918
    ## 10 0010         0.927        0.927
    ## # ℹ 4,990 more rows

``` r
weather_bootstrap |>
  summarize(
    beta_lower_ci=quantile(b1x2, 0.025),
    beta_upper_ci=quantile(b1x2, 0.975)
  )
```

    ## # A tibble: 5,000 × 3
    ##    id    beta_lower_ci beta_upper_ci
    ##    <chr>         <dbl>         <dbl>
    ##  1 0001           1.00          1.00
    ##  2 0002           1.01          1.01
    ##  3 0003           1.00          1.00
    ##  4 0004           1.02          1.02
    ##  5 0005           1.02          1.02
    ##  6 0006           1.04          1.04
    ##  7 0007           1.01          1.01
    ##  8 0008           1.01          1.01
    ##  9 0009           1.02          1.02
    ## 10 0010           1.01          1.01
    ## # ℹ 4,990 more rows

Lastly, we’ll plot distributions.

``` r
weather_bootstrap |>
  ggplot(aes(x=b1x2)) + geom_density()
```

![](p8105_hw6_eb3516_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

``` r
weather_bootstrap |>
  ggplot(aes(x=r_squared)) + geom_density()
```

![](p8105_hw6_eb3516_files/figure-gfm/unnamed-chunk-5-2.png)<!-- -->
